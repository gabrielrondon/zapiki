openapi: 3.0.3
info:
  title: Zapiki - Zero-Knowledge Proof as a Service API
  description: |
    Zapiki is a universal Zero-Knowledge Proof platform that abstracts cryptographic complexity
    behind a simple REST API. Generate and verify cryptographic proofs without deep knowledge
    of cryptography.

    **Core Concept:** "Stripe for Zero-Knowledge Proofs"

    ## Features
    - Multiple proof systems (Commitment, Groth16, PLONK, STARK)
    - Pre-built templates for common use cases
    - Synchronous & asynchronous proof generation
    - Batch proof generation (up to 100 proofs per request)
    - Prometheus metrics for monitoring and observability
    - Simple REST API with API key authentication

    ## Proof Systems

    ### Commitment (Fast - ~50ms)
    Simple hash-based commitments with digital signatures. Perfect for timestamping and
    simple proofs of knowledge.

    ### Groth16 (zk-SNARK - ~30s)
    Zero-knowledge Succinct Non-interactive ARgument of Knowledge with trusted setup.
    Small proof size, fast verification.

    ### PLONK (zk-SNARK - ~35s)
    Universal setup zk-SNARK. No per-circuit trusted setup required. More flexible than Groth16.

    ### STARK (Transparent - ~40s)
    Scalable Transparent ARgument of Knowledge. No trusted setup required, quantum-resistant,
    hash-based proofs. Larger proof size but completely transparent and verifiable by anyone.

    ## Authentication
    All API requests (except /health) require an API key in the `X-API-Key` header.

    ## Rate Limiting
    - Free tier: 100 requests/minute
    - Pro tier: 10,000 requests/minute

  version: 1.3.0
  contact:
    name: Zapiki API Support
    url: https://github.com/gabrielrondon/zapiki
  license:
    name: MIT

servers:
  - url: https://zapiki-production.up.railway.app
    description: Production server
  - url: http://localhost:8080
    description: Local development server

security:
  - ApiKeyAuth: []

tags:
  - name: Health
    description: System health and status
  - name: Proof Systems
    description: Information about available proof systems
  - name: Proofs
    description: Generate and manage cryptographic proofs
  - name: Templates
    description: Pre-built circuits for common use cases
  - name: Verification
    description: Verify proofs
  - name: AML/KYC Compliance
    description: Banking AML/KYC compliance templates for privacy-preserving identity verification
  - name: Monitoring
    description: Prometheus metrics for observability
  - name: Circuits
    description: Custom circuit management

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the API and all dependent services are healthy
      security: []
      responses:
        '200':
          description: All services are healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [healthy]
                  services:
                    type: object
                    properties:
                      api:
                        type: string
                        enum: [ok]
                      postgres:
                        type: string
                        enum: [ok]
                      redis:
                        type: string
                        enum: [ok]
              example:
                status: healthy
                services:
                  api: ok
                  postgres: ok
                  redis: ok
        '503':
          description: One or more services are unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /metrics:
    get:
      tags:
        - Monitoring
      summary: Prometheus metrics
      description: |
        Exposes Prometheus-compatible metrics for monitoring and observability.
        Use this endpoint to scrape metrics with Prometheus, Grafana, or similar tools.

        Metrics include:
        - HTTP request duration and counts
        - Proof generation metrics (count, duration, by system)
        - Verification metrics
        - Queue and job metrics
        - Database connection pool
        - API key usage
        - System resources (Go runtime metrics)
      security: []
      responses:
        '200':
          description: Prometheus metrics in text format
          content:
            text/plain:
              schema:
                type: string
              example: |
                # HELP zapiki_http_requests_total Total HTTP requests
                # TYPE zapiki_http_requests_total counter
                zapiki_http_requests_total{method="POST",path="/api/v1/proofs",status="2xx"} 142

                # HELP zapiki_proofs_generated_total Total proofs generated
                # TYPE zapiki_proofs_generated_total counter
                zapiki_proofs_generated_total{proof_system="commitment",status="completed"} 98
                zapiki_proofs_generated_total{proof_system="groth16",status="completed"} 23

                # HELP zapiki_proof_generation_duration_seconds Proof generation duration
                # TYPE zapiki_proof_generation_duration_seconds histogram
                zapiki_proof_generation_duration_seconds_bucket{proof_system="commitment",le="0.1"} 98
                zapiki_proof_generation_duration_seconds_bucket{proof_system="groth16",le="30"} 23

  /api/v1/systems:
    get:
      tags:
        - Proof Systems
      summary: List available proof systems
      description: Get information about all available proof systems and their capabilities
      responses:
        '200':
          description: List of proof systems
          content:
            application/json:
              schema:
                type: object
                properties:
                  systems:
                    type: array
                    items:
                      $ref: '#/components/schemas/ProofSystem'
              example:
                systems:
                  - name: commitment
                    capabilities:
                      supports_setup: false
                      requires_trusted_setup: false
                      supports_custom_circuits: false
                      async_only: false
                      typical_generation_time: 50
                      max_proof_size: 512
                      features:
                        - fast-generation
                        - simple-commitment
                        - digital-signature
                  - name: groth16
                    capabilities:
                      supports_setup: true
                      requires_trusted_setup: true
                      supports_custom_circuits: true
                      async_only: true
                      typical_generation_time: 30000
                      max_proof_size: 1024
                      features:
                        - zero-knowledge
                        - succinct-proofs
                        - fast-verification
                  - name: plonk
                    capabilities:
                      supports_setup: true
                      requires_trusted_setup: false
                      supports_custom_circuits: true
                      async_only: true
                      typical_generation_time: 35000
                      max_proof_size: 2048
                      features:
                        - zero-knowledge
                        - universal-setup
                        - no-per-circuit-setup
                        - flexible
                  - name: stark
                    capabilities:
                      supports_setup: false
                      requires_trusted_setup: false
                      supports_custom_circuits: true
                      async_only: true
                      typical_generation_time: 40000
                      max_proof_size: 102400
                      features:
                        - transparent
                        - no-trusted-setup
                        - quantum-resistant
                        - hash-based
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/proofs:
    post:
      tags:
        - Proofs
      summary: Generate a proof
      description: |
        Generate a cryptographic proof for given data.
        - Commitment proofs return immediately (synchronous)
        - SNARK proofs (Groth16, PLONK) return a job_id (asynchronous)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateProofRequest'
            examples:
              commitment:
                summary: Simple commitment proof
                value:
                  proof_system: commitment
                  data:
                    type: string
                    value: "My secret message"
              groth16_template:
                summary: Age verification using template
                value:
                  proof_system: groth16
                  data:
                    type: json
                    value:
                      age: 25
                      threshold: 18
                  options:
                    template_id: "550e8400-e29b-41d4-a716-446655440000"
              stark_proof:
                summary: STARK transparent proof
                value:
                  proof_system: stark
                  data:
                    type: json
                    value:
                      a: 7
                      b: 8
                      c: 56
      responses:
        '200':
          description: Proof generated successfully (sync) or job created (async)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProofResponse'
              examples:
                sync_commitment:
                  summary: Synchronous commitment proof
                  value:
                    proof_id: "7fb193c9-1e97-4f09-99f6-2bc96d73d7f7"
                    status: completed
                    proof:
                      commitment: "ee4df64c3452de90a63b9dc3101bb9e57980fe808417574e97b36921ed5dcb1b"
                      nonce: "b45b8b4d9f03bc5da49153686ff41eb0de618a39557c6c708cce9af01b72c933"
                      signature: "896b37c93f3f644e55eba9afe960cdab..."
                      timestamp: "2026-01-30T15:43:11.460029239Z"
                      public_key: "37ca7fd1732ba38e7b64edb51abdf61864d7fd7c9ad9f472803251ec7dd110cf"
                    verification_key:
                      public_key: "37ca7fd1732ba38e7b64edb51abdf61864d7fd7c9ad9f472803251ec7dd110cf"
                async_snark:
                  summary: Asynchronous SNARK proof (job created)
                  value:
                    proof_id: "8ab194d0-2e98-5f10-aa07-3cd07d84e8g8"
                    status: pending
                    job_id: "9bc195e1-3f09-6g21-bb18-4de18e95f9h9"
                    message: "Proof generation in progress. Poll /api/v1/proofs/{proof_id} for status"
                async_stark:
                  summary: Asynchronous STARK proof (transparent, no trusted setup)
                  value:
                    proof_id: "9cd295f2-4g20-7h32-cc29-5ef29f06g0j0"
                    status: pending
                    job_id: "adc396g3-5h21-8i43-dd30-6fg30g17h1k1"
                    message: "STARK proof generation in progress (transparent, quantum-resistant)"
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalError'

    get:
      tags:
        - Proofs
      summary: List proofs
      description: List all proofs for the authenticated user with pagination
      parameters:
        - name: limit
          in: query
          description: Maximum number of proofs to return
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          description: Number of proofs to skip
          schema:
            type: integer
            default: 0
            minimum: 0
        - name: status
          in: query
          description: Filter by proof status
          schema:
            type: string
            enum: [pending, completed, failed]
      responses:
        '200':
          description: List of proofs
          content:
            application/json:
              schema:
                type: object
                properties:
                  proofs:
                    type: array
                    items:
                      $ref: '#/components/schemas/ProofMetadata'
                  pagination:
                    type: object
                    properties:
                      limit:
                        type: integer
                      offset:
                        type: integer
                      total:
                        type: integer
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/proofs/{id}:
    get:
      tags:
        - Proofs
      summary: Get proof by ID
      description: Retrieve a specific proof by its ID. Use this to check status of async proofs.
      parameters:
        - name: id
          in: path
          required: true
          description: Proof ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Proof details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProofResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Proof not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Proofs
      summary: Delete proof
      description: Delete a proof by ID
      parameters:
        - name: id
          in: path
          required: true
          description: Proof ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Proof deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Proof not found

  /api/v1/proofs/batch:
    post:
      tags:
        - Proofs
      summary: Generate multiple proofs in batch
      description: |
        Generate multiple proofs in a single request. Each proof is processed independently,
        and the response includes individual results for each proof (success or failure).

        **Features:**
        - Maximum 100 proofs per batch request
        - Independent processing (one failure doesn't affect others)
        - Returns individual status for each proof
        - Supports all proof systems (commitment, groth16, plonk, stark)

        **Use Cases:**
        - Batch processing multiple commitments
        - Generating proofs for multiple users
        - High-throughput scenarios
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - proofs
              properties:
                proofs:
                  type: array
                  minItems: 1
                  maxItems: 100
                  description: Array of proof generation requests
                  items:
                    $ref: '#/components/schemas/GenerateProofRequest'
            example:
              proofs:
                - proof_system: commitment
                  data:
                    type: string
                    value: "Document 1 hash"
                - proof_system: commitment
                  data:
                    type: string
                    value: "Document 2 hash"
                - proof_system: groth16
                  data:
                    type: json
                    value:
                      age: 25
                      threshold: 18
                  options:
                    template_id: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: Batch proof generation results
          content:
            application/json:
              schema:
                type: object
                required:
                  - results
                  - total
                  - success
                  - failed
                properties:
                  results:
                    type: array
                    description: Individual results for each proof in the batch
                    items:
                      type: object
                      required:
                        - index
                        - success
                      properties:
                        index:
                          type: integer
                          description: Index of the proof in the original request array
                        success:
                          type: boolean
                          description: Whether proof generation succeeded
                        response:
                          $ref: '#/components/schemas/ProofResponse'
                          description: Proof response if successful
                        error:
                          type: string
                          description: Error message if failed
                  total:
                    type: integer
                    description: Total number of proofs in batch
                  success:
                    type: integer
                    description: Number of successful proofs
                  failed:
                    type: integer
                    description: Number of failed proofs
              example:
                results:
                  - index: 0
                    success: true
                    response:
                      proof_id: "a1b2c3d4-e5f6-4a5b-8c7d-9e0f1a2b3c4d"
                      status: completed
                      proof:
                        commitment: "abc123..."
                        signature: "def456..."
                      verification_key:
                        public_key: "ghi789..."
                  - index: 1
                    success: true
                    response:
                      proof_id: "b2c3d4e5-f6a7-5b6c-9d8e-0f1a2b3c4d5e"
                      status: completed
                      proof:
                        commitment: "xyz789..."
                        signature: "uvw012..."
                      verification_key:
                        public_key: "rst345..."
                  - index: 2
                    success: false
                    error: "Invalid template ID"
                total: 3
                success: 2
                failed: 1
        '400':
          description: Bad request (empty batch, exceeds max size, invalid format)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                empty_batch:
                  summary: Empty batch
                  value:
                    error: "No proofs provided"
                exceeds_max:
                  summary: Exceeds maximum batch size
                  value:
                    error: "Maximum batch size is 100"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/aml/age-verification:
    post:
      tags:
        - AML/KYC Compliance
      summary: Age verification proof
      description: |
        Generate a zero-knowledge proof that a person's age is greater than or equal to
        a minimum threshold without revealing their exact birthdate.

        **Use Case:** KYC compliance - prove user is 18+ without storing birthdate.

        **Privacy:** Birthdate is NOT revealed. Only proves age ≥ minimum_age.

        **Proof System:** Groth16 (zk-SNARK)

        **Generation Time:** ~30 seconds (async)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - minimum_age
                - current_year
                - birth_year
              properties:
                minimum_age:
                  type: integer
                  minimum: 1
                  maximum: 150
                  description: Minimum age requirement (e.g., 18 for adult verification)
                  example: 18
                current_year:
                  type: integer
                  minimum: 1900
                  maximum: 2100
                  description: Current year
                  example: 2026
                birth_year:
                  type: integer
                  minimum: 1900
                  description: User's birth year (private input, not revealed in proof)
                  example: 1990
                nonce:
                  type: string
                  description: Optional nonce for proof uniqueness (auto-generated if not provided)
                  example: "unique-nonce-12345"
            example:
              minimum_age: 18
              current_year: 2026
              birth_year: 1990
      responses:
        '202':
          description: Age verification proof generation started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProofResponse'
              example:
                proof_id: "810cff9a-b10f-414a-a7ed-c6f8e1b46d06"
                status: "pending"
                message: "Proof generation started. Poll /api/v1/proofs/810cff9a-b10f-414a-a7ed-c6f8e1b46d06 for status."
        '400':
          description: Invalid input (age out of range, birth year invalid, etc.)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/aml/sanctions-check:
    post:
      tags:
        - AML/KYC Compliance
      summary: Sanctions list check proof
      description: |
        Generate a zero-knowledge proof that a user is NOT on a sanctions list
        (OFAC, UN, etc.) without revealing their identity.

        **Use Case:** AML compliance - prove non-sanctioned status without exposing PII.

        **Privacy:** User identity is NOT revealed. Only proves non-membership in sanctions list.

        **Proof System:** Groth16 (zk-SNARK)

        **Note:** This is a simplified implementation. Production systems should use
        Merkle tree exclusion proofs or similar cryptographic data structures.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - sanctions_list_root
                - user_identifier
              properties:
                sanctions_list_root:
                  type: string
                  description: Merkle root or hash of the current sanctions list
                  example: "0x1234abcd5678ef90..."
                current_timestamp:
                  type: integer
                  format: int64
                  description: Unix timestamp (auto-generated if not provided)
                  example: 1704067200
                user_identifier:
                  type: string
                  description: Hashed user identifier (private input)
                  example: "hash_of_user_id_12345"
            example:
              sanctions_list_root: "0x1234abcd5678ef90..."
              current_timestamp: 1704067200
              user_identifier: "hash_of_user_id_12345"
      responses:
        '202':
          description: Sanctions check proof generation started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProofResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/aml/residency-proof:
    post:
      tags:
        - AML/KYC Compliance
      summary: Residency verification proof
      description: |
        Generate a zero-knowledge proof that a user resides in an allowed country
        without revealing their exact address.

        **Use Case:** Geo-compliance - prove jurisdiction without exposing location details.

        **Privacy:** Full address is NOT revealed. Only proves country code matches.

        **Proof System:** Groth16 (zk-SNARK)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - allowed_country_code
                - user_country_code
              properties:
                allowed_country_code:
                  type: integer
                  description: Allowed country code (e.g., 1 for USA, 44 for UK)
                  example: 1
                current_timestamp:
                  type: integer
                  format: int64
                  description: Unix timestamp (auto-generated if not provided)
                  example: 1704067200
                user_country_code:
                  type: integer
                  description: User's actual country code (private input)
                  example: 1
                address_hash:
                  type: string
                  description: SHA-256 hash of full address (commitment, not revealed)
                  example: "sha256_of_123_main_st_..."
            example:
              allowed_country_code: 1
              current_timestamp: 1704067200
              user_country_code: 1
              address_hash: "sha256_of_123_main_st_..."
      responses:
        '202':
          description: Residency proof generation started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProofResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/aml/income-verification:
    post:
      tags:
        - AML/KYC Compliance
      summary: Income verification proof
      description: |
        Generate a zero-knowledge proof that a user's income is greater than or equal
        to a minimum threshold without revealing their exact salary.

        **Use Case:** Lending/credit - prove creditworthiness without exposing income details.

        **Privacy:** Exact income is NOT revealed. Only proves income ≥ threshold.

        **Proof System:** Groth16 (zk-SNARK)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - minimum_income
                - actual_income
              properties:
                minimum_income:
                  type: integer
                  description: Minimum income requirement (e.g., 50000 USD)
                  example: 50000
                current_timestamp:
                  type: integer
                  format: int64
                  description: Unix timestamp (auto-generated if not provided)
                  example: 1704067200
                actual_income:
                  type: integer
                  description: User's actual income (private input, not revealed)
                  example: 75000
                income_source_hash:
                  type: string
                  description: SHA-256 hash of income source document (W2, tax return, etc.)
                  example: "sha256_of_w2_document..."
            example:
              minimum_income: 50000
              current_timestamp: 1704067200
              actual_income: 75000
              income_source_hash: "sha256_of_w2_document..."
      responses:
        '202':
          description: Income verification proof generation started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProofResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/templates:
    get:
      tags:
        - Templates
      summary: List available templates
      description: Get all pre-built circuit templates for common use cases
      parameters:
        - name: category
          in: query
          description: Filter by category
          schema:
            type: string
            enum: [Identity, Financial, Math, Custom]
        - name: proof_system
          in: query
          description: Filter by proof system
          schema:
            type: string
            enum: [commitment, groth16, plonk, stark]
      responses:
        '200':
          description: List of templates
          content:
            application/json:
              schema:
                type: object
                properties:
                  templates:
                    type: array
                    items:
                      $ref: '#/components/schemas/Template'
              example:
                templates:
                  - id: "cfabb910-498d-44fc-94ee-b6e162d6b1cf"
                    name: "Age Verification (18+)"
                    description: "Prove you are 18 or older without revealing your exact age"
                    category: "Identity"
                    proof_system: "groth16"
                    input_schema:
                      type: object
                      required: [age, threshold, over_threshold]
                      properties:
                        age:
                          type: number
                          description: "Your actual age (kept secret)"
                        threshold:
                          type: number
                          description: "Minimum age requirement"
                        over_threshold:
                          type: number
                          enum: [1]
                          description: "Must be 1"
                    example_inputs:
                      age: 25
                      threshold: 18
                      over_threshold: 1
                    is_active: true
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/templates/{id}/generate:
    post:
      tags:
        - Templates
      summary: Generate proof from template
      description: |
        Generate a proof using a pre-built template. This is the easiest way to generate
        complex ZK proofs without understanding circuit design.
      parameters:
        - name: id
          in: path
          required: true
          description: Template ID (UUID)
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - inputs
              properties:
                inputs:
                  type: object
                  description: Input values matching the template's input_schema
                  additionalProperties: true
            examples:
              age_verification:
                summary: Age verification (18+)
                value:
                  inputs:
                    age: 25
                    threshold: 18
                    over_threshold: 1
              salary_range:
                summary: Salary range verification
                value:
                  inputs:
                    salary: 75000
                    min_salary: 50000
                    max_salary: 150000
                    in_range: 1
      responses:
        '200':
          description: Proof generated (or job created for async)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProofResponse'
        '400':
          description: Invalid inputs for template
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Template not found

  /api/v1/verify:
    post:
      tags:
        - Verification
      summary: Verify a proof
      description: Verify the validity of a cryptographic proof
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - proof_system
                - proof
                - verification_key
              properties:
                proof_system:
                  type: string
                  enum: [commitment, groth16, plonk, stark]
                proof:
                  type: object
                  description: The proof object returned from proof generation
                verification_key:
                  type: object
                  description: The verification key returned from proof generation
                public_inputs:
                  type: array
                  items:
                    type: string
                  description: Public inputs for SNARK proofs (optional for commitment)
            example:
              proof_system: commitment
              proof:
                commitment: "ee4df64c3452de90a63b9dc3101bb9e57980fe808417574e97b36921ed5dcb1b"
                nonce: "b45b8b4d9f03bc5da49153686ff41eb0de618a39557c6c708cce9af01b72c933"
                signature: "896b37c93f3f644e55eba9afe960cdab..."
                timestamp: "2026-01-30T15:43:11.460029239Z"
                public_key: "37ca7fd1732ba38e7b64edb51abdf61864d7fd7c9ad9f472803251ec7dd110cf"
              verification_key:
                public_key: "37ca7fd1732ba38e7b64edb51abdf61864d7fd7c9ad9f472803251ec7dd110cf"
      responses:
        '200':
          description: Verification result
          content:
            application/json:
              schema:
                type: object
                required:
                  - valid
                properties:
                  valid:
                    type: boolean
                  verification_time_ms:
                    type: integer
                    description: Time taken to verify in milliseconds
              examples:
                valid:
                  summary: Valid proof
                  value:
                    valid: true
                    verification_time_ms: 5
                invalid:
                  summary: Invalid proof
                  value:
                    valid: false
                    verification_time_ms: 3
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/circuits:
    get:
      tags:
        - Circuits
      summary: List circuits
      description: List all circuits available to the user (public + user's private circuits)
      responses:
        '200':
          description: List of circuits
          content:
            application/json:
              schema:
                type: object
                properties:
                  circuits:
                    type: array
                    items:
                      $ref: '#/components/schemas/Circuit'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      tags:
        - Circuits
      summary: Create custom circuit
      description: |
        Upload a custom circuit definition (advanced users only).
        Requires understanding of circuit design.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - proof_system
                - circuit_definition
              properties:
                name:
                  type: string
                description:
                  type: string
                proof_system:
                  type: string
                  enum: [groth16, plonk]
                circuit_definition:
                  type: object
                  description: Circuit definition in JSON format
                is_public:
                  type: boolean
                  default: false
      responses:
        '201':
          description: Circuit created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Circuit'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: |
        API key for authentication. Get your API key from the Zapiki dashboard.

        Example: `X-API-Key: test_zapiki_key_1230ab3c044056686e2552fb5a2648cd`

  schemas:
    ProofSystem:
      type: object
      properties:
        name:
          type: string
          enum: [commitment, groth16, plonk, stark]
        capabilities:
          type: object
          properties:
            supports_setup:
              type: boolean
            requires_trusted_setup:
              type: boolean
            supports_custom_circuits:
              type: boolean
            async_only:
              type: boolean
            typical_generation_time:
              type: integer
              description: Typical generation time in milliseconds
            max_proof_size:
              type: integer
              description: Maximum proof size in bytes
            features:
              type: array
              items:
                type: string

    GenerateProofRequest:
      type: object
      required:
        - proof_system
        - data
      properties:
        proof_system:
          type: string
          enum: [commitment, groth16, plonk, stark]
          description: Which proof system to use
        data:
          type: object
          required:
            - type
            - value
          properties:
            type:
              type: string
              enum: [string, json, bytes]
              description: Type of input data
            value:
              oneOf:
                - type: string
                - type: object
                - type: array
              description: The actual data to prove (format depends on type)
        public_inputs:
          type: array
          items:
            type: string
          description: Public inputs for SNARK proofs (optional)
        options:
          type: object
          properties:
            template_id:
              type: string
              format: uuid
              description: Use a pre-built template
            circuit_id:
              type: string
              format: uuid
              description: Use a specific circuit
            async:
              type: boolean
              description: Force async processing (default auto-detected)

    ProofResponse:
      type: object
      required:
        - proof_id
        - status
      properties:
        proof_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending, completed, failed]
        proof:
          type: object
          description: The generated proof (only present when status=completed)
        verification_key:
          type: object
          description: Key needed to verify the proof
        generation_time_ms:
          type: integer
          description: Time taken to generate proof in milliseconds
        job_id:
          type: string
          format: uuid
          description: Job ID for async proofs (when status=pending)
        message:
          type: string
          description: Human-readable message

    ProofMetadata:
      type: object
      properties:
        id:
          type: string
          format: uuid
        proof_system:
          type: string
          enum: [commitment, groth16, plonk, stark]
        status:
          type: string
          enum: [pending, completed, failed]
        created_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        circuit_id:
          type: string
          format: uuid

    Template:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        category:
          type: string
          enum: [Identity, Financial, Math, Custom]
        proof_system:
          type: string
          enum: [commitment, groth16, plonk, stark]
        circuit_id:
          type: string
          format: uuid
        input_schema:
          type: object
          description: JSON Schema describing required inputs
        example_inputs:
          type: object
          description: Example input values
        documentation:
          type: string
          description: Markdown documentation for the template
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time

    Circuit:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        proof_system:
          type: string
          enum: [groth16, plonk]
        is_public:
          type: boolean
        created_at:
          type: string
          format: date-time
        user_id:
          type: string
          format: uuid

    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Error message
        code:
          type: integer
          description: HTTP status code
        details:
          type: object
          description: Additional error details

  responses:
    UnauthorizedError:
      description: Missing or invalid API key
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Unauthorized
            code: 401

    BadRequestError:
      description: Invalid request parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Invalid request body
            code: 400

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Internal server error
            code: 500
